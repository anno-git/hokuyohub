# 実装計画: デフォルト設定の変更（ポイントを表示）

目的
- 初回起動時から点群が可視化される状態を既定化し、利用開始直後の理解コストを下げる。
- 具体的には「Raw Points」「Filtered Data」を既定で表示 ON とする。

対象
- [webui/index.html](webui/index.html)
- [webui/app.js](webui/app.js)

現状の把握
- WebUI オーバーレイに以下のチェックボックスがある（Raw/Filtered/Per-sensor Colors）。
  - [webui/index.html](webui/index.html)
- 表示状態はフロント側の以下の変数により制御されている。
  - showRaw, showFiltered, perSensorColor（[webui/app.js](webui/app.js)）
- 受信/描画パスは既に存在するため（clusters-lite/raw-lite/filtered-lite 受信と再描画）、サーバ側の追加実装は不要。
  - 受信ハンドラ: [ws.onmessage()](webui/app.js:171)
  - 再描画: [redrawCanvas()](webui/app.js:216)

変更方針
- index.html 側で Raw/Filtered のチェックボックスに checked 属性を付与（初期 ON）。
- app.js 側の初期状態 showRaw/showFiltered を true に合わせておく（冗長防御）。
- Per-sensor Colors は既定 OFF のまま（大規模点群での色分けは描画負荷に寄与するため）。

具体手順
1) index.html のチェックボックスに checked を付与
   - Raw Points
     - 変更対象: [webui/index.html](webui/index.html)
     - 該当要素: input#show-raw-points
     - 変更: <input type="checkbox" id="show-raw-points" checked>
   - Filtered Data
     - 変更対象: [webui/index.html](webui/index.html)
     - 該当要素: input#show-filtered-data
     - 変更: <input type="checkbox" id="show-filtered-data" checked>

2) app.js の初期値を明示的に true に設定
   - 変更対象: [webui/app.js](webui/app.js)
   - 変数初期化
     - let showRaw = true;
     - let showFiltered = true;
     - let perSensorColor = false; // 既定 OFF 維持
   - 初期状態適用時に updateLegend() / redrawCanvas() は既存の onmessage や resize/DOMContentLoaded ハンドラで呼ばれるため追加処理は不要。

3) 初期表示の品質確認
   - 点数が非常に多い場合の描画負荷に備え、必要なら Performance モードの説明（キー p/P）をヘルプ文言に追記（任意）。
     - ヘルプテキスト: [webui/index.html](webui/index.html)
     - パフォーマンス切替: [togglePerformanceMode()](webui/app.js:311)

受け入れ基準（テスト観点）
- 新規起動で Raw/Filtered が可視状態になっている。
- チェックを OFF にすると即座に非表示になる（既存のイベントハンドラで担保）。
  - Raw: [showRawCheckbox change ハンドラ](webui/app.js:744)
  - Filtered: [showFilteredCheckbox change ハンドラ](webui/app.js:750)
- レジェンドは per-sensor-colors が OFF のため既定では非表示（ON にすると表示）。
  - [updateLegend()](webui/app.js:701)

非機能・パフォーマンス
- 大きな点群で初期負荷が増える可能性がある。
  - 既定で perSensorColor を OFF にしておくことで塗り分け描画負荷を抑制。
  - 必要に応じて performanceMode の既定 ON を将来検討（現時点では変更しない）。

リスクと対処
- サーバから raw-lite/filtered-lite のストリームが届かない場合、空表示となる。
  - ステータス領域（[updateStatsDisplay()](webui/app.js:112)）で age/fps/seq を確認できるため、UX的には問題なし。
- 将来サーバ側で初期表示ポリシーを制御したくなる場合は、スナップショットに UI 初期表示設定を追加する設計も可能（現状はクライアント既定で対応）。

ロールバック手順
- index.html の checked を削除。
- app.js の showRaw/showFiltered を false に戻す。

作業粒度・変更規模
- 小（フロントエンドのみ、2ファイルの微小修正）。

関連ファイル（参照）
- [webui/index.html](webui/index.html)
- [webui/app.js](webui/app.js)

想定工数
- 実装・セルフテスト: 0.5h
- コードレビュー・微修正: 0.5h